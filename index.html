<html lang="en">
  <head>
    <title>URL generator</title>
    <style>
      .hidden { display: none; }
      .step { margin: 10px; }
    </style>
    <script src="filters.js"></script>
    <script>
      function ready(){
        document.querySelector('#url').onkeyup=function(){
          theurl=document.querySelector('#url').value;
          theurl=theurl.replace(/^https?:\/\/[^/]*/,"").replace(/^\//,"");

          document.querySelector("#output").innerHTML=location.href+theurl;
        }
      }

      function fetch(url)
      {
        var request = new XMLHttpRequest();
        request.open('GET', url, true);

        request.onload = function() {
          if (request.status >= 200 && request.status < 400) {
            // Success!
            try{
              JSON.parse(request.responseText)
              console.log("Good JSON");
            }catch(e){
              err("Invalid JSON! \"<code>"+e.message+"</code>\"",request.responseText);
              _data=request.responseText;
              removeClass(document.querySelector("#step2"),"hidden");
            }
          } else {
            err("Unable to retrieve file","Status code: "+request.status+"\n"+request.responseText);
            removeClass(document.querySelector("#step2"),"hidden");;
          }
        };

        request.onerror = function() {
          err("Unable to connect to server","No data");
        };
        request.send();
      }

      function err(msg,data)
      {
        document.querySelector("#jsonout").innerHTML="<div>"+msg+"</div><br/><div><code>"+data+"</code></div>";
      }

      function removeClass(el,cl)
      {
        if (el.classList)
          el.classList.remove(cl);
        else
          el.cl = el.className.replace(new RegExp('(^|\\b)' + className.split(' ').join('|') + '(\\b|$)', 'gi'), ' ');
      }

      function testFilters()
      {
        
      }

    </script>
  </head>
  <body onload="ready();">
    <div class="step" id="step1">
    <h3>Enter JSON URL</h3>
    <input type="text" size="100" name="url" id="url"></input><br/>
    <button id="fetch" onclick="fetch(document.querySelector('#url').value)">Test JSON URL</button><br/>
  </div>
  <div class="step hidden" id="step2">
    <div id="jsonout"></div>
    <button name="testFilters" id="testFilters" onclick="testFilters()">Test filters</button>
  </div>
  <div class="step hidden" id="step9">
    <div>URL to use: <span id="output"></span></div>
  </div>

  </body>
</html>
